fileFormatVersion: 2
guid: b8cdf2ca095fa4b65a277da8f0d19d4d
importerOverride: ZEPETO.Script.Compiler:ZEPETO.Script:TypescriptAssetImporter
ScriptedImporter:
  internalIDToNameTable: []
  externalObjects: {}
  serializedVersion: 2
  userData: 
  assetBundleName: 
  assetBundleVariant: 
  script: {fileID: -1123457745, guid: 54cf806323ffe4418a4ce4cc63fe6b9d, type: 3}
  isAssemblyDeclarations: 0
  assembly: 
  generateAllTypes: 1
  types: []
  generateWrapper: 0
  overrideWrapperTypes: 0
  wrapperTypes: []
  WrapperFilters: []
  wrapperOutputDirectory: Generated
  compiledResult: '{"source":"\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\",
    { value: true });\r\nconst ZEPETO_Script_1 = require(\"ZEPETO.Script\");\r\nconst
    UnityEngine_1 = require(\"UnityEngine\");\r\nconst ZEPETO_Multiplay_1 = require(\"ZEPETO.Multiplay\");\r\nconst
    MultiplayManager_1 = require(\"../Common/MultiplayManager\");\r\nconst ZEPETO_World_1
    = require(\"ZEPETO.World\");\r\nconst SyncIndexManager_1 = require(\"../Common/SyncIndexManager\");\r\nclass
    AnimatorSyncHelper extends ZEPETO_Script_1.ZepetoScriptBehaviour {\r\n    get
    Id() {\r\n        return this._Id;\r\n    }\r\n    Start() {\r\n        this._animator
    = this.GetComponentInChildren($typeof(UnityEngine_1.Animator));\r\n        SyncIndexManager_1.default.SyncIndex++;\r\n       
    this._Id = SyncIndexManager_1.default.SyncIndex.toString();\r\n        this._multiplay
    = UnityEngine_1.Object.FindObjectOfType($typeof(ZEPETO_World_1.ZepetoWorldMultiplay));\r\n       
    this._multiplay.add_RoomJoined((room) => {\r\n            this._room = room;\r\n           
    this.SyncMessageHandler();\r\n        });\r\n    }\r\n    ChangeOwner(ownerSessionId)
    {\r\n        if (null == this._room)\r\n            this._room = MultiplayManager_1.default.instance.room;\r\n       
    if (this._room.SessionId == ownerSessionId) {\r\n            if (!this._isMasterClient)
    {\r\n                this._isMasterClient = true;\r\n                this._sendCoroutine
    = this.StartCoroutine(this.SendAnimatorCoroutine());\r\n            }\r\n           
    this.SendAnimator();\r\n        }\r\n        else if (this._room.SessionId !=
    ownerSessionId && this._isMasterClient) {\r\n            this._isMasterClient
    = false;\r\n            if (null != this._sendCoroutine)\r\n                this.StopCoroutine(this._sendCoroutine);\r\n       
    }\r\n    }\r\n    *SendAnimatorCoroutine() {\r\n        while (true) {\r\n           
    yield new UnityEngine_1.WaitForSeconds(10);\r\n            this.SendAnimator();\r\n       
    }\r\n    }\r\n    SendAnimator() {\r\n        console.log(\"send\");\r\n       
    this.stateInfo = this._animator.GetCurrentAnimatorStateInfo(0);\r\n        const
    clipName = this.stateInfo.shortNameHash;\r\n        const clipTime = this.stateInfo.normalizedTime
    * this.stateInfo.length;\r\n        const data = new ZEPETO_Multiplay_1.RoomData();\r\n       
    data.Add(\"Id\", this._Id);\r\n        data.Add(\"clipName\", clipName);\r\n       
    data.Add(\"clipTime\", clipTime);\r\n        data.Add(\"sendTime\", MultiplayManager_1.default.instance.GetServerTime());\r\n       
    this._room?.Send(\"AnimatorSync\", data.GetObject());\r\n    }\r\n    SyncMessageHandler()
    {\r\n        const ResponseId = \"AnimatorSync\" + this._Id;\r\n        this._room.AddMessageHandler(ResponseId,
    (message) => {\r\n            this.GetSyncPosition(message);\r\n        });\r\n   
    }\r\n    GetSyncPosition(message) {\r\n        const latency = (MultiplayManager_1.default.instance.GetServerTime()
    - Number(message.sendTime)) / 1000;\r\n        this._animator.Play(message.clipName,
    0, message.clipTime + latency);\r\n    }\r\n}\r\nexports.default = AnimatorSyncHelper;\r\n//#
    sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQW5pbWF0b3JTeW5jSGVscGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQW5pbWF0b3JTeW5jSGVscGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsaURBQXFEO0FBQ3JELDZDQUFnSDtBQUNoSCx1REFBZ0Q7QUFDaEQsaUVBQTBEO0FBQzFELCtDQUFrRDtBQUNsRCxpRUFBMEQ7QUFFMUQsTUFBcUIsa0JBQW1CLFNBQVEscUNBQXFCO0lBV2pFLElBQUksRUFBRTtRQUNGLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQztJQUNwQixDQUFDO0lBR08sS0FBSztRQUNULElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLHNCQUFzQixTQUFDLHNCQUFRLEVBQUcsQ0FBQztRQUV6RCwwQkFBZ0IsQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUM3QixJQUFJLENBQUMsR0FBRyxHQUFHLDBCQUFnQixDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUNqRCxJQUFJLENBQUMsVUFBVSxHQUFHLG9CQUFNLENBQUMsZ0JBQWdCLFNBQUMsbUNBQW9CLEVBQUcsQ0FBQztRQUNsRSxJQUFJLENBQUMsVUFBVSxnQkFBZSxDQUFDLElBQVUsRUFBRSxFQUFFO1lBQ3pDLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1lBQ2xCLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1FBQzlCLENBQUMsRUFBQztJQUNOLENBQUM7SUFFTSxXQUFXLENBQUMsY0FBcUI7UUFDcEMsSUFBRyxJQUFJLElBQUksSUFBSSxDQUFDLEtBQUs7WUFDakIsSUFBSSxDQUFDLEtBQUssR0FBRywwQkFBZ0IsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDO1FBQ2hELElBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLElBQUksY0FBYyxFQUFDO1lBQ3RDLElBQUcsQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFO2dCQUN0QixJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FB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","assetPath":"Assets/Zepeto
    Multiplay Component/ZepetoScript/Transform/AnimatorSyncHelper.ts","manifest":{"properties":[],"name":"AnimatorSyncHelper","description":""},"isCompiled":true}'
  typescriptHash: 460339a61aa50d49e504eb5acf7a77f6
  onlyWriteTrigger: 0
